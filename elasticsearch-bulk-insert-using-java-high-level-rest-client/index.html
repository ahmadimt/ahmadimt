<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Elasticsearch: Bulk Insert using Java High Level Rest Client - imteyazahmad.com</title><meta name="description" content="Using Elasticsearch bulk request to insert large amount of data."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://imteyazahmad.com/elasticsearch-bulk-insert-using-java-high-level-rest-client/"><link rel="amphtml" href="https://imteyazahmad.com/amp/elasticsearch-bulk-insert-using-java-high-level-rest-client/"><link rel="alternate" type="application/atom+xml" href="https://imteyazahmad.com/feed.xml"><link rel="alternate" type="application/json" href="https://imteyazahmad.com/feed.json"><meta property="og:title" content="Elasticsearch: Bulk Insert using Java High Level Rest Client"><meta property="og:image" content="https://imteyazahmad.com/media/posts/6/dance-schools-1837658_cropped-2.jpg"><meta property="og:site_name" content="imteyazahmad.com"><meta property="og:description" content="Using Elasticsearch bulk request to insert large amount of data."><meta property="og:url" content="https://imteyazahmad.com/elasticsearch-bulk-insert-using-java-high-level-rest-client/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@ahmad_imt"><meta name="twitter:title" content="Elasticsearch: Bulk Insert using Java High Level Rest Client"><meta name="twitter:description" content="Using Elasticsearch bulk request to insert large amount of data."><meta name="twitter:image" content="https://imteyazahmad.com/media/posts/6/dance-schools-1837658_cropped-2.jpg"><link rel="shortcut icon" href="https://imteyazahmad.com/media/website/favicon.ico" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://imteyazahmad.com/assets/css/style.css?v=ae37e7df1e4b7b6e1b8a7bfccb475079"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://imteyazahmad.com/elasticsearch-bulk-insert-using-java-high-level-rest-client/"},"headline":"Elasticsearch: Bulk Insert using Java High Level Rest Client","datePublished":"2021-04-10T09:46","dateModified":"2021-04-15T20:09","image":{"@type":"ImageObject","url":"https://imteyazahmad.com/media/posts/6/dance-schools-1837658_cropped-2.jpg","height":1280,"width":1920},"description":"Using Elasticsearch bulk request to insert large amount of data.","author":{"@type":"Person","name":"Imteyaz Ahmad"},"publisher":{"@type":"Organization","name":"Imteyaz Ahmad"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-T957TM7KCN"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-T957TM7KCN');</script><script>(function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
mixpanel.init("968c5552713a748212f557194a438880", {batch_requests: true})</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/command-line/prism-command-line.css" integrity="sha512-AXkwLHLL+pk9u1qv7m2BFtxp/eGXLj0kx4BMrBtiGjOlfZfAQFCuS38ZPG7/PMEG8Csc5fM7BEhH6/dFLmccEw==" crossorigin="anonymous"></head><body><div class="container"><header class="header" id="js-header"><a href="https://imteyazahmad.com/" class="logo">imteyazahmad.com</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://imteyazahmad.com/authors/imteyaz-ahmad/" target="_self">About Me</a></li></ul></nav></header><main><article class="post wrapper"><header class="hero"><p class="post__meta">By <a href="https://imteyazahmad.com/authors/imteyaz-ahmad/" rel="author" title="Imteyaz Ahmad">Imteyaz Ahmad</a> Published on <time datetime="2021-04-10T09:46">April 10, 2021</time></p><h1 class="post__title">Elasticsearch: Bulk Insert using Java High Level Rest Client</h1></header><figure class="post__featured-image post__image--normal"><img src="https://imteyazahmad.com/media/posts/6/dance-schools-1837658_cropped-2.jpg" srcset="https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-xs.jpg 300w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-sm.jpg 480w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-md.jpg 768w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-lg.jpg 1024w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-xl.jpg 1360w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-2xl.jpg 1600w, https://imteyazahmad.com/media/posts/6/responsive/dance-schools-1837658_cropped-2-sm2.jpg 375w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1280" width="1920" alt=""><figcaption>Image by Hans Braxmeier from Pixabay</figcaption></figure><div class="post__entry"><p id="introduction">In our <a href="https://imteyazahmad.com/elasticsearch-searching-using-java-high-level-rest-client/" target="_blank">previous post</a>, we saw how to insert data into Elasticsearch using the&nbsp;<code>curl</code> command. In this post, we will use Java High Level Rest Client to achieve the same.</p><h2 id="introduction">Introduction</h2><p>For any use case, data is essential. If we already have some data in&nbsp;Elasticsearch, we can use it. Otherwise, we will have to insert some data into it. In this post, we will see how to bulk insert data using Java High Level Rest Client. The details about instantiating and configuring&nbsp;the client can be found <a href="https://imteyazahmad.com/configuring-elasticsearch-java-high-level-rest-client-2/" target="_blank">here</a>.</p><h2 id="data-preparation">Data Preparation</h2><p>We will use the accounts data present <a href="https://github.com/ahmadimt/elasticsearch_samples/blob/main/bulk_insert/app/src/main/resources/accounts.json" target="_blank" rel="nofollow noopener">here</a>. The following represents a single document in the <code>accounts</code> index in Elasticsearch:</p><pre class="line-numbers language-json"><code>{"account_number":1,"balance":39225,"firstname":"Amber","lastname":"Duke","age":32,"gender":"M","address":"880 Holmes Lane","employer":"Pyrami","email":"amberduke@pyrami.com","city":"Brogan","state":"IL"}</code></pre><h2 id="writing-datanbsp">Writing Data&nbsp;</h2><p>Let's create an <code>Account</code> class that represents a single document as shown above in the index.&nbsp;</p><pre class="line-numbers language-java"><code>public class Account {     
private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper();   
@JsonProperty("account_number")
private long accountNumber;
@JsonProperty("balance")
private long balance;
@JsonProperty("firstname")
private String firstname;
@JsonProperty("lastname")
private String lastname;
@JsonProperty("age")
private int age;
@JsonProperty("gender")
private String gender;
@JsonProperty("address")
private String address;
@JsonProperty("employer")
private String employer;
@JsonProperty("email")
private String email;
@JsonProperty("city")
private String city;
@JsonProperty("state")
private String state;
//Getter and Setter removed for brevity

// This method is used to convert an instance of Account class to map. 
// This is done because IndexRequest accepts a map as a source.
public static Map&lt;String, Object&gt; getAsMap(final Account account) {
  return OBJECT_MAPPER.convertValue(account, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {
      });
  }  
}

</code></pre><p>We have one another class called <code>AccountManager</code> which reads the data from the file and writes into the Elasticsearch index:</p><pre class="line-numbers language-java"><code>/**
 * The type Account manager.
 */
public class AccountManager {

  private final RestHighLevelClient restHighLevelClient;

  /**
   *     Instantiates a new Account manager.
   *
   * @param restHighLevelClient the rest high level client
   */
  public AccountManager(final RestHighLevelClient restHighLevelClient) {
    this.restHighLevelClient = restHighLevelClient;
  }

  /**
   * Read data from the file and return as a List&lt;Account&gt;.
   *
   * @param fileName the file name
   * @return the list
   * @throws IOException the io exception
   */
  public List&lt;Account&gt; readAccounts(String fileName) throws IOException {
    final File file = new File(fileName);
    final Account[] accounts = new ObjectMapper().readValue(file, Account[].class);
    return Arrays.asList(accounts);
  }

  /**
   * Write accounts data into Elasticsearch
   *
   * @param accounts  the accounts
   * @param indexName the index name
   * @return the bulk response
   * @throws IOException the io exception
   */
  public BulkResponse writeAccounts(List&lt;Account&gt; accounts, String indexName) throws IOException {
    final var bulkRequest = new BulkRequest();
    accounts.forEach(account -&gt; {
      final var indexRequest = new IndexRequest(indexName);
      indexRequest.source(Account.getAsMap(account));
      bulkRequest.add(indexRequest);
    });
    return restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);
  }
}
</code></pre><p>The important thing to notice here is how we are creating the <code>BulkRequest</code> (Line#39-44). For each <code>Account</code> in the list, we are creating a new <code>IndexRequest</code> with the given index name and then passing the current account data as a map to it, which is then added to the instance of bulk request.</p><p>Once the bulk request is prepared we are calling&nbsp;<code>restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT)</code> to insert data into Elasticsearch.</p><h2 id="testingnbsp">Testing&nbsp;</h2><p>The following is a test to write data into Elasticsearch:</p><pre class="line-numbers language-java"><code>  @Test
  public void writeAccountsValidAccountAndIndexNameShouldReturnBulkResponse() throws IOException {
    final URL resource = AccountManager.class.getClassLoader()
        .getResource("accounts.json");
    Assertions.assertThat(resource).isNotNull();
    final List&lt;Account&gt; accounts = accountManager.readAccounts(resource.getFile());
    final var bulkItemResponses = accountManager.writeAccounts(accounts, "accounts_test");
    Assertions.assertThat(bulkItemResponses.hasFailures()).isFalse();
    Assertions.assertThat(bulkItemResponses).isNotEmpty().hasSize(1000);
  }</code></pre><h2 id="references">References</h2><ul><li>https://pixabay.com/photos/dance-schools-mosquitoes-mass-1837658/?download</li><li>https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json<br></li><li>https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high.html<br></li></ul></div><footer class="post__footer"><div class="post__last-updated">This article was updated on April 15, 2021</div><div class="post__footer__col"><ul class="post__tag"><li><a href="https://imteyazahmad.com/tags/elasticsearch/">Elasticsearch</a></li><li><a href="https://imteyazahmad.com/tags/high-level-rest-client/">high level rest client</a></li><li><a href="https://imteyazahmad.com/tags/java/">Java</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F&amp;via=ahmad_imt&amp;text=Elasticsearch%3A%20Bulk%20Insert%20using%C2%A0Java%20High%20Level%20Rest%20Client" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F&amp;media=https%3A%2F%2Fimteyazahmad.com%2Fmedia%2Fposts%2F6%2Fdance-schools-1837658_cropped-2.jpg&amp;description=Elasticsearch%3A%20Bulk%20Insert%20using%C2%A0Java%20High%20Level%20Rest%20Client" class="js-share pinterest" aria-label="[MISSING TRANSLATION] Share with Pinterest" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://mix.com/add?url=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F" class="js-share mix" aria-label="Share with Mix" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#mix"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F&amp;title=Elasticsearch%3A%20Bulk%20Insert%20using%C2%A0Java%20High%20Level%20Rest%20Client" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Elasticsearch%3A%20Bulk%20Insert%20using%C2%A0Java%20High%20Level%20Rest%20Client&amp;url=https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=Elasticsearch%3A%20Bulk%20Insert%20using%C2%A0Java%20High%20Level%20Rest%20Client https%3A%2F%2Fimteyazahmad.com%2Felasticsearch-bulk-insert-using-java-high-level-rest-client%2F" class="js-share whatsapp" aria-label="Share with Whats App" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#whatsapp"/></svg></a></div></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://imteyazahmad.com/elasticsearch-searching-using-java-high-level-rest-client/" class="inverse" rel="prev">Elasticsearch: Query using Java High Level Rest Client</a></h5></div><div class="post__nav__next">Next Post<h5><a href="https://imteyazahmad.com/elasticsearch-pre-indexing-transformation-using-ingest-pipelines/" class="inverse" rel="next">Elasticsearch: A Short Introduction to Ingest Pipelines</a></h5></div></nav><div class="post__bio"><img src="https://imteyazahmad.com/media/website/1580139940845.jpeg" loading="lazy" alt="Imteyaz Ahmad"><div><h3><a href="https://imteyazahmad.com/authors/imteyaz-ahmad/" class="inverse" title="Imteyaz Ahmad">Imteyaz Ahmad</a></h3></div></div><div class="post__related"><h3 class="u-h5">Related posts</h3><div class="post__related__wrap"><figure><a href="https://imteyazahmad.com/elasticsearch-get-document-counts-using-java-high-level-rest-client/"><img src="https://imteyazahmad.com/media/posts/8/responsive/hand-162127-xs.png" loading="lazy" alt=""></a><figcaption><h4><a href="https://imteyazahmad.com/elasticsearch-get-document-counts-using-java-high-level-rest-client/" class="inverse">Elasticsearch: Get Document Counts using Java High Level Rest Client</a></h4><time datetime="2021-04-22T20:14">April 22, 2021</time></figcaption></figure><figure><a href="https://imteyazahmad.com/elasticsearch-pre-indexing-transformation-using-ingest-pipelines/"><img src="https://imteyazahmad.com/media/posts/7/responsive/digitization-5140055_1920-xs.jpg" loading="lazy" alt=""></a><figcaption><h4><a href="https://imteyazahmad.com/elasticsearch-pre-indexing-transformation-using-ingest-pipelines/" class="inverse">Elasticsearch: A Short Introduction to Ingest Pipelines</a></h4><time datetime="2021-04-12T19:29">April 12, 2021</time></figcaption></figure><figure><a href="https://imteyazahmad.com/elasticsearch-searching-using-java-high-level-rest-client/"><img src="https://imteyazahmad.com/media/posts/4/responsive/hand-1248053_1920-2-xs.jpg" loading="lazy" alt=""></a><figcaption><h4><a href="https://imteyazahmad.com/elasticsearch-searching-using-java-high-level-rest-client/" class="inverse">Elasticsearch: Query using Java High Level Rest Client</a></h4><time datetime="2021-04-07T10:03">April 7, 2021</time></figcaption></figure></div></div></footer></article><div class="comments wrapper"><h3 class="u-h5">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = 'https://imteyazahmad.com/elasticsearch-bulk-insert-using-java-high-level-rest-client/';
            		this.page.identifier = '6';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://imteyazahmad.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></main><footer class="footer"><div class="footer__copyright">© <a href="https://imteyazahmad.com/" target="_blank" rel="nofollow noopener">Imteyaz Ahmad - All Rights Reserved.</a></div><div class="footer__social"><a href="ahmad_imt" class="twitter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.linkedin.com/in/imteyaz-ahmad-09b66b28/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://imteyazahmad.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div></footer></div><script defer="defer" src="https://imteyazahmad.com/assets/js/scripts.min.js?v=c3bbc0611ea6a5405014eaca34fe1814"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.navbar'};</script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-clike.min.js" integrity="sha512-xXwwAe8scUySEhtfaHNqIBors65zyXbtpUOwKjOxesrIwna3Aca9XqcomKMx22u84uRTzsx1Hm7cIM/s1XPzgQ==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-java.min.js" integrity="sha512-PWHY6Vao4E9K4LsGBYCY0ttDeiWZwuUozTbJvSy9UFHRz2J4Bl7rcWML3wEnJTVuCJhSwGne/8My5gTo/gnbpg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-bash.min.js" integrity="sha512-JvRd44DHaJAv/o3wxi/dxhz2TO/jwwX8V5/LTr3gj6QMQ6qNNGXk/psoingLDuc5yZmccOq7XhpVaelIZE4tsQ==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha512-br8H6OngKoLht57WKRU5jz3Vr0vF+Tw4G6yhNN2F3dSDheq4JiaasROPJB1wy7PxPk7kV/+5AIbmoZLxxx7Zow==" crossorigin="anonymous"></script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                    var checkedGroups = popup.querySelectorAll('input[type="checkbox"]:checked');

                    for (var i = 0; i < checkedGroups.length; i++) {
                        var allowedGroup = checkedGroups[i].name.replace('gdpr-', '');

                        if (allowedGroup !== '-' && allowedGroup !== '') {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');
                        var checkedCheckboxes = popup.querySelectorAll('input[type="checkbox"]:checked');

                        for (var j = 0; j < checkedCheckboxes.length; j++) {
                            var name = checkedCheckboxes[j].name.replace('gdpr-', '');

                            if (allowedGroups.indexOf(name) === -1) {
                                checkedCheckboxes[j].checked = false;
                            }
                        }

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>